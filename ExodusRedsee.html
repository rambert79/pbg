<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Exodus: Heavenly Glory v3.2</title>
    <style>
        :root {
            --sea-deep: #002f6c; --sea-top: #4fc3f7; --foam: rgba(255,255,255,0.8);
            --ground-dark: #795548; --ground-light: #d4b46a; --sand: #f0d082;
            --accent: #ffd700; --enemy-glow: rgba(255, 0, 0, 0.8);
        }

        html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: 'Malgun Gothic', sans-serif; background: #000; }
        
        /* ë‚œì´ë„ í™”ë©´ */
        #setup-screen { position: fixed; inset: 0; background: radial-gradient(circle at center, #01579b, #000); display: flex; align-items: center; justify-content: center; z-index: 5000; color: white; }
        .setup-box { background: rgba(0,0,0,0.9); padding: 40px; border-radius: 50px; border: 4px solid var(--accent); text-align: center; width: 85%; max-width: 440px; }
        .diff-group { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 30px; cursor: pointer; margin-top: 15px; border: 2px solid transparent; transition: 0.3s; }
        .diff-group:hover { background: rgba(255,255,255,0.15); border-color: var(--accent); transform: translateY(-5px); }

        #game-container { position: relative; width: 100vw; height: 100vh; background: #001a33; overflow: hidden; perspective: 1200px; display: none; transition: background 2s ease; }
        
        /* [ê°œì„ ] ì„±ì „ ë° ì²œìƒì˜ ë¹› íš¨ê³¼ */
        #goal { position: absolute; top: -50px; left: 50%; transform: translateX(-50%) rotateX(-25deg); width: 150%; height: 200px; background: linear-gradient(to bottom, #2e7d32, #81c784); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10; border-bottom: 20px solid #1b5e20; transition: all 1.5s ease; }
        
        /* í™”ì´íŠ¸ì•„ì›ƒ ë ˆì´ì–´ */
        #white-out { position: fixed; inset: 0; background: white; opacity: 0; pointer-events: none; z-index: 8000; transition: opacity 0.5s ease; }

        /* í• ë ë£¨ì•¼ í…ìŠ¤íŠ¸ */
        #victory-text { position: fixed; top: 40%; left: 50%; transform: translate(-50%, -50%) scale(0); color: gold; font-size: 60px; font-weight: 900; z-index: 9000; text-shadow: 0 0 30px white; opacity: 0; transition: all 1s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

        /* ë°”ë‹¤ ë° ì§€ë©´ ì„¤ì • */
        #path { position: absolute; left: 50%; top: 0; width: 450px; height: 100%; background: radial-gradient(ellipse at center, transparent 60%, rgba(0,0,0,0.4) 100%), repeating-linear-gradient(to bottom, var(--ground-dark), var(--ground-dark) 2px, var(--ground-light) 5px); background-color: var(--sand); transform: translateX(-50%); transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1); z-index: 1; }
        .sea-wall { position: absolute; top: 0; width: 60vw; height: 140%; z-index: 5; pointer-events: none; transition: margin 1.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .wall-left { right: 50%; margin-right: 225px; transform-origin: right center; border-right: 25px solid var(--foam); animation: seaWiggleLeft 4s infinite ease-in-out; }
        .wall-right { left: 50%; margin-left: 225px; transform-origin: left center; border-left: 25px solid var(--foam); animation: seaWiggleRight 4s infinite ease-in-out; }
        @keyframes seaWiggleLeft { 0%, 100% { transform: rotateY(40deg) skewY(-5deg) translateX(0); } 50% { transform: rotateY(43deg) skewY(-6deg) translateX(-15px); } }
        @keyframes seaWiggleRight { 0%, 100% { transform: rotateY(-40deg) skewY(5deg) translateX(0); } 50% { transform: rotateY(-43deg) skewY(6deg) translateX(15px); } }

        /* ì…ì ì• ë‹ˆë©”ì´ì…˜ */
        .bless-particle { position: fixed; pointer-events: none; z-index: 6000; border-radius: 50%; animation: floatUp 3s forwards; }
        @keyframes floatUp { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-800px) scale(0); opacity: 0; } }

        #enemy-army { position: absolute; left: 0; bottom: 0; width: 100%; height: 0px; background: linear-gradient(to top, var(--enemy-glow), transparent); z-index: 8; transition: height 0.1s linear; border-top: 8px solid #ff0000; }
        #moses-group { position: absolute; left: 50%; bottom: 120px; transform: translateX(-50%); z-index: 25; display: flex; flex-direction: column; align-items: center; transition: all 0.5s ease-out; }
        .word { position: absolute; color: white; font-weight: bold; font-size: 26px; text-shadow: 0 5px 15px #000; z-index: 100; padding: 12px 24px; background: rgba(0,0,0,0.85); border-radius: 50px; border: 3px solid var(--accent); white-space: nowrap; transform: translateX(-50%); }

        #game-modal { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.98); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; backdrop-filter: blur(30px); color: white; text-align: center; }
        .modal-content { background: #111; padding: 50px; border-radius: 50px; border: 4px solid var(--accent); }
    </style>
</head>
<body>
<a href="index.html" style="position: fixed; top: 15px; left: 15px; z-index: 10000; text-decoration: none; color: white; background: rgba(0,0,0,0.5); padding: 8px 16px; border-radius: 20px; font-size: 14px; border: 1px solid rgba(255,255,255,0.3); backdrop-filter: blur(5px); font-weight: bold;">
    ğŸ  ë©”ì¸ í—ˆë¸Œë¡œ
</a>
<div id="white-out"></div>
<div id="victory-text">HALLELUJAH!</div>

<div id="setup-screen">
    <div class="setup-box">
        <h1 style="color:var(--accent); font-size: 45px; margin:0 0 10px 0;">ì¶œì• êµ½ ì—¬ì • v3.2</h1>
        <div class="diff-group" onclick="initGame('easy')">
            <div style="font-size:26px; font-weight:800; color:#81c784;">Easy í‰í™”ë¡œìš´ ì‹œì‘</div>
            <div style="font-size:15px; opacity:0.85;">êµ°ëŒ€ê°€ ì²œì²œíˆ ì¶œë°œí•˜ë©° ë°±ì„±ë“¤ì„ ë°°ë ¤í•©ë‹ˆë‹¤.</div>
        </div>
        <div class="diff-group" onclick="initGame('normal')">
            <div style="font-size:26px; font-weight:800; color:#64b5f6;">Normal í‘œì¤€ ì—¬ì •</div>
            <div style="font-size:15px; opacity:0.85;">í‘œì¤€ì ì¸ ì¶”ê²© ì†ë„ì…ë‹ˆë‹¤. ì§€í˜œë¡­ê²Œ ì „ì§„í•˜ì„¸ìš”.</div>
        </div>
        <div class="diff-group" onclick="initGame('hard')">
            <div style="font-size:26px; font-weight:800; color:#e57373;">Hard ê³ ë‚œì˜ ì‹œí—˜</div>
            <div style="font-size:15px; opacity:0.85;">ê°€ë‚˜ì•ˆ ë„ì°© í›„ êµ°ëŒ€ì˜ ë¶„ë…¸ê°€ ê·¹ì— ë‹¬í•©ë‹ˆë‹¤.</div>
        </div>
    </div>
</div>

<div id="game-container">
    <div id="goal"><div style="font-size: 55px;">ğŸ›ï¸</div><div style="font-size: 26px; font-weight: bold;">ê±°ë£©í•œ ê°€ë‚˜ì•ˆ ì„±ì „</div></div>
    <div id="path"></div>
    <div class="sea-wall wall-left" id="w-left"><div class="wall-content" style="width:100%;height:100%;background:linear-gradient(to bottom, var(--sea-top), var(--sea-deep));"></div></div>
    <div class="sea-wall wall-right" id="w-right"><div class="wall-content" style="width:100%;height:100%;background:linear-gradient(to bottom, var(--sea-top), var(--sea-deep));"></div></div>
    <div id="enemy-army"></div>
    <div id="moses-group">
        <div id="moses-main" style="font-size:85px; filter: drop-shadow(0 0 25px gold);">ğŸ§”ğŸ¾â€â™‚ï¸</div>
        <div style="font-size:32px">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ğŸ‘¶</div>
    </div>
    <div id="input-container" style="position:absolute; bottom:30px; left:50%; transform:translateX(-50%); z-index:200; width:85%; max-width:400px;">
        <input type="text" id="word-input" style="width:100%; padding:22px; border-radius:50px; border:5px solid var(--accent); font-size:24px; text-align:center; outline:none;" placeholder="ë§ì”€ì„ ì…ë ¥í•˜ì„¸ìš”!" autocomplete="off">
    </div>
</div>

<div id="game-modal">
    <div class="modal-content">
        <h2 id="modal-title" style="font-size: 40px; color: var(--accent); margin:0;"></h2>
        <p id="modal-desc" style="font-size: 22px; margin-top: 25px;"></p>
        <button style="margin-top:40px; padding:18px 50px; border-radius:40px; border:none; background:var(--accent); font-weight:bold; font-size:24px; cursor:pointer;" onclick="location.reload()">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
    </div>
</div>

<script>
    const bibleWords = ["ëª¨ì„¸", "ì•„ë¸Œë¼í•¨", "ë‹¤ìœ—", "ì†”ë¡œëª¬", "ì´ìŠ¤ë¼ì—˜", "ì—¬í˜¸ìˆ˜ì•„", "í™í•´", "ë§Œë‚˜", "ì‹­ê³„ëª…", "ë¯¿ìŒ", "ì†Œë§", "ì‚¬ë‘", "ë² ë“œë¡œ", "ë°”ìš¸", "ìš”í•œ"];
    let activeWords = [], pathWidth = 450, enemyHeight = -50, mosesPos = 120, isArrived = false, isGameOver = false, audioCtx = null;
    let difficulty = 'normal', enemySpeed = 0.5;

    const inputField = document.getElementById('word-input');
    const container = document.getElementById('game-container');
    const modal = document.getElementById('game-modal');

    function initGame(level) {
        difficulty = level;
        document.getElementById('setup-screen').style.display = 'none';
        container.style.display = 'block';
        if(difficulty === 'easy') { enemyHeight = -150; enemySpeed = 0.35; }
        else if(difficulty === 'hard') { enemySpeed = 0.65; }
        updateWalls(); spawnWord(); update(); inputField.focus();
    }

    // [í•µì‹¬ ê°œì„ ] ì„±ì „ ì…ì„± ì‹œë„¤ë§ˆí‹± íš¨ê³¼
    function playDivineMiracle() {
        const whiteOut = document.getElementById('white-out');
        const victoryText = document.getElementById('victory-text');
        const goal = document.getElementById('goal');
        
        // 1. í™”ì´íŠ¸ì•„ì›ƒ ì„¬ê´‘
        whiteOut.style.opacity = '0.8';
        setTimeout(() => whiteOut.style.opacity = '0', 500);

        // 2. ë°°ê²½ ë° ì„±ì „ ë³€í™”
        container.style.background = 'radial-gradient(circle at center, #fff9c4, #ffd54f)';
        goal.style.boxShadow = '0 0 200px 100px gold';
        goal.style.background = 'gold';

        // 3. í• ë ë£¨ì•¼ í…ìŠ¤íŠ¸ ë“±ì¥
        setTimeout(() => {
            victoryText.style.opacity = '1';
            victoryText.style.transform = 'translate(-50%, -50%) scale(1.5)';
        }, 300);

        // 4. ëŒ€ëŸ‰ì˜ ì…ì í­ë°œ
        for(let i=0; i<100; i++) {
            setTimeout(() => {
                const p = document.createElement('div');
                p.className = 'bless-particle';
                p.style.width = (Math.random() * 15 + 5) + 'px';
                p.style.height = p.style.width;
                p.style.background = `hsl(${Math.random()*50 + 40}, 100%, 70%)`;
                p.style.left = Math.random() * 100 + 'vw';
                p.style.top = '100vh';
                p.style.boxShadow = '0 0 20px white';
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 3000);
            }, i * 20);
        }
    }

    function triggerEnd(isWin, title, desc) {
        if(isGameOver) return;
        isGameOver = true;
        inputField.blur();
        if(isWin) {
            playSound(440, 'sine'); playSound(554, 'sine'); playSound(659, 'sine');
            playDivineMiracle(); // ê°•í™”ëœ ì—°ì¶œ ì‹¤í–‰
        } else {
            playSound(55, 'sawtooth');
            container.style.animation = 'shake 0.5s';
        }
        setTimeout(() => {
            document.getElementById('modal-title').innerText = title;
            document.getElementById('modal-desc').innerText = desc;
            modal.style.display = 'flex';
        }, 2500); // ì—°ì¶œì„ ì¶©ë¶„íˆ ì¦ê¸´ í›„ ëª¨ë‹¬ í‘œì‹œ
    }

    function playSound(freq, type) {
        try {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
            osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1.2);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 1.2);
        } catch(e) {}
    }

    function update() {
        if(isGameOver) return;
        enemyHeight += enemySpeed;
        document.getElementById('enemy-army').style.height = Math.max(0, enemyHeight) + 'px';
        activeWords.forEach((word, i) => {
            word.top += word.speed; word.el.style.top = word.top + 'px';
            if (word.top > window.innerHeight) { word.el.remove(); activeWords.splice(i, 1); }
        });
        if (!isArrived && mosesPos > window.innerHeight - 260) {
            isArrived = true;
            document.getElementById('moses-group').style.bottom = (window.innerHeight - 60) + 'px';
            document.getElementById('moses-main').innerText = "ğŸ‘‘";
            if(difficulty === 'hard') enemySpeed += 0.5;
        }
        if (isArrived && pathWidth <= 45) { triggerEnd(true, "ğŸ•Šï¸ ì•½ì†ì˜ ë•… ì…ì„±", "ëª¨ë“  ë°±ì„±ì´ ê¸°ì  ì†ì—ì„œ ê°€ë‚˜ì•ˆ ì„±ì „ì— ì…ì„±í–ˆìŠµë‹ˆë‹¤!"); return; }
        if (enemyHeight > window.innerHeight - 70) { triggerEnd(false, "ğŸ”¥ ê°€ë‚˜ì•ˆ í•¨ë½", "ë°”ë‹¤ê°€ ë‹«íˆì§€ ì•Šì•„ ì„±ì§€ê°€ ì¹¨ë²”ë‹¹í–ˆìŠµë‹ˆë‹¤."); return; }
        if (!isArrived && enemyHeight > mosesPos - 60) { triggerEnd(false, "ğŸŒŠ ì—¬ì • ì¤‘ë‹¨", "êµ°ëŒ€ì—ê²Œ ë°±ì„±ë“¤ì´ ì¡íˆê³  ë§ì•˜ìŠµë‹ˆë‹¤."); return; }
        requestAnimationFrame(update);
    }

    function updateWalls() {
        document.getElementById('path').style.width = pathWidth + 'px';
        document.getElementById('w-left').style.marginRight = (pathWidth / 2) + 'px';
        document.getElementById('w-right').style.marginLeft = (pathWidth / 2) + 'px';
    }

    inputField.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            const val = inputField.value.trim();
            const index = activeWords.findIndex(w => w.text === val);
            if (index !== -1) {
                if (isArrived) pathWidth = Math.max(0, pathWidth - 125);
                else { mosesPos += 90; document.getElementById('moses-group').style.bottom = mosesPos + 'px'; enemyHeight -= 70; }
                activeWords[index].el.remove(); activeWords.splice(index, 1);
                playSound(350, 'square');
            } else { pathWidth = Math.max(20, pathWidth - 110); playSound(90, 'sawtooth'); }
            inputField.value = ''; updateWalls();
        }
    });

    function spawnWord() {
        if(isGameOver) return;
        const wordText = bibleWords[Math.floor(Math.random()*bibleWords.length)];
        const el = document.createElement('div');
        el.className = 'word'; el.innerText = wordText;
        el.style.left = (Math.floor(Math.random() * 70) + 15) + "vw";
        el.style.top = "-80px";
        container.appendChild(el);
        activeWords.push({ el, text: wordText, top: -80, speed: Math.random()*0.6 + 1.0 });
        setTimeout(spawnWord, 1600);
    }
</script>
</body>

</html>
