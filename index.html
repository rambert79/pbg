<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="favicon-badgereversi.png">
    <link rel="apple-touch-icon" href="favicon-badgereversi.png">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Pure Logic Badge Reversi v29.1</title>
    <style>
        :root {
            --board-color: #2e7d32; --accent: #4caf50; --p1-neon: #4caf50; --p2-neon: #2196f3;
            --board-size: 75vmin; --cell-size: calc(var(--board-size) / 8.5); --badge-size: calc(var(--cell-size) * 0.7);
            --bg-color: #f8f8f8; --text-color: #1a1a1a; --setup-bg: #ffffff; --card-bg: rgba(0,0,0,0.05);
        }
        @media (prefers-color-scheme: dark) {
            :root { --bg-color: #0a0a0a; --text-color: #ffffff; --setup-bg: #1a1a1a; --card-bg: rgba(255,255,255,0.08); }
        }
        body { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; font-family: system-ui, -apple-system, sans-serif; background-color: var(--bg-color); color: var(--text-color); overflow: hidden; }

        /* ì„¤ì • í™”ë©´ */
        #setup-screen { position: fixed; inset: 0; background: var(--bg-color); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .setup-container { background: var(--setup-bg); padding: 30px; border-radius: 28px; text-align: center; width: 90%; max-width: 400px; border: 1px solid rgba(128,128,128,0.2); box-shadow: 0 20px 50px rgba(0,0,0,0.15); }
        .player-box { background: var(--card-bg); padding: 15px; border-radius: 18px; margin-bottom: 12px; border-left: 5px solid transparent; }
        .player-box.p1 { border-left-color: var(--p1-neon); }
        .player-box.p2 { border-left-color: var(--p2-neon); }
        .player-label { font-size: 11px; font-weight: 900; text-align: left; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
        .emoji-grid { display: flex; justify-content: center; gap: 8px; }
        .emoji-item { font-size: 24px; cursor: pointer; padding: 6px; border-radius: 12px; border: 2px solid rgba(128,128,128,0.2); background: var(--setup-bg); }
        .emoji-item.selected { border-color: var(--accent); background: rgba(76, 175, 80, 0.1); transform: scale(1.1); }
        .theme-grid { display: flex; justify-content: center; gap: 10px; margin-top: 8px; }
        .theme-dot { width: 26px; height: 26px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; }
        .theme-dot.selected { border-color: var(--text-color); transform: scale(1.1); }

        /* ê²Œì„ ë³´ë“œ ë° ë°°ì§€ */
        #board-container { padding: 8px; border-radius: 15px; background: var(--card-bg); transition: 0.6s; }
        body.p1-turn #board-container { box-shadow: 0 0 40px var(--p1-neon); }
        body.p2-turn #board-container { box-shadow: 0 0 40px var(--p2-neon); }
        #board { display: grid; grid-template-columns: repeat(8, var(--cell-size)); grid-template-rows: repeat(8, var(--cell-size)); gap: 1.5px; background-color: rgba(128,128,128,0.2); border-radius: 8px; }
        .cell { background-color: var(--board-color); display: flex; align-items: center; justify-content: center; cursor: pointer; perspective: 1000px; }
        .badge-container { width: 90%; height: 90%; position: relative; transition: transform 0.7s cubic-bezier(0.175, 0.885, 0.32, 1.275); transform-style: preserve-3d; }
        .badge-container.flipped { transform: rotateY(180deg); }
        .badge-face { position: absolute; inset: 0; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; font-size: var(--badge-size); border-radius: 50%; }
        .badge-back { transform: rotateY(180deg); }
        .focus-card { font-size: 40px; transition: 0.4s; opacity: 0.1; }
        .focus-card.active { opacity: 1; animation: pulse 1.5s infinite ease-in-out; }
        @keyframes pulse { 0%, 100% { transform: scale(1.1); } 50% { transform: scale(1.3); } }

        /* UI ë° ëª¨ë‹¬ */
        .top-controls { display: flex; gap: 10px; margin-bottom: 15px; }
        .btn-ui { padding: 8px 16px; border-radius: 15px; border: 1px solid rgba(128,128,128,0.3); background: var(--card-bg); color: var(--text-color); cursor: pointer; font-weight: bold; font-size: 13px; }
        #top-indicator { width: 200px; height: 4px; background: rgba(128,128,128,0.2); margin-bottom: 15px; position: relative; overflow: hidden; border-radius: 2px; }
        #progress-bar { position: absolute; width: 50%; height: 100%; background: var(--accent); transition: left 0.4s ease; }
        #score-panel { display: flex; gap: 40px; margin-top: 15px; font-size: 20px; font-weight: 800; }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; z-index: 2000; backdrop-filter: blur(5px); }
        .modal-content { background: var(--setup-bg); color: var(--text-color); padding: 30px; border-radius: 25px; text-align: center; border: 2px solid var(--accent); max-width: 320px; width: 85%; }

        /* [ì‹ ê·œ] ìˆœìˆ˜ CSS í­ì£½ ì¡°ê° */
        .confetti { position: fixed; width: 10px; height: 10px; z-index: 3000; pointer-events: none; }
    </style>
</head>
<body>

    <div id="setup-screen">
        <div class="setup-container">
            <h2 style="color:var(--accent); margin:0 0 20px 0;">BADGE REVERSI</h2>
            <div class="player-box p1"><div class="player-label" style="color:var(--p1-neon)">Player 1</div><div id="p1-emojis" class="emoji-grid"></div></div>
            <div class="player-box p2"><div class="player-label" style="color:var(--p2-neon)">Player 2</div><div id="p2-emojis" class="emoji-grid"></div></div>
            <div><div class="player-label" style="text-align:center">Theme</div><div id="theme-options" class="theme-grid"></div></div>
            <button class="btn-ui" style="background:var(--accent); color:white; margin-top:25px; width:100%; height:50px; font-size:16px;" onclick="startGame()">BATTLE START</button>
        </div>
    </div>

    <div class="top-controls">
        <button class="btn-ui" onclick="location.reload()">âš™ï¸ Settings</button>
        <button class="btn-ui" onclick="openRestartModal()">ğŸ”„ Restart</button>
        <button id="pass-btn" class="btn-ui" onclick="handlePass()" disabled>â­ï¸ Pass</button>
    </div>
    <div id="top-indicator"><div id="progress-bar"></div></div>
    <div style="display:flex; gap:30px; margin-bottom:10px; align-items:center;">
        <div id="p1-card" class="focus-card active"></div>
        <div style="font-size: 14px; opacity: 0.5; font-weight: 900;">VS</div>
        <div id="p2-card" class="focus-card"></div>
    </div>
    <div id="board-container"><div id="board"></div></div>
    <div id="score-panel"><div id="p1-score-ui"></div><div id="p2-score-ui"></div></div>

    <div id="restart-modal" class="modal-overlay"><div class="modal-content"><h3>Restart?</h3><div style="display:flex; gap:10px; margin-top:20px;"><button class="btn-ui" style="flex:1" onclick="confirmRestart(true)">Yes</button><button class="btn-ui" style="flex:1" onclick="confirmRestart(false)">No</button></div></div></div>
    <div id="result-modal" class="modal-overlay"><div class="modal-content"><div id="modal-winner-icon" style="font-size:60px;">ğŸ†</div><div id="modal-result-text" style="font-size:20px; margin:15px 0;">WINNER!</div><button class="btn-ui" style="background:var(--accent); color:white; width:100%" onclick="location.reload()">New Game</button></div></div>

    <script>
        const emojiPool = ['âš«','âšª','ğŸ»','ğŸ°','ğŸŒ','ğŸŒš','ğŸ”¥','â„ï¸','ğŸ”','ğŸŸ','ğŸ®','â­','ğŸ€','ğŸ„','ğŸ¯','ğŸ¦Š','ğŸ¥‘','ğŸš€','ğŸ’','ğŸ‘»','ğŸ','ğŸˆ','ğŸ§','ğŸ¸','ğŸ•','ğŸ¦','ğŸ¦','ğŸ¨','ğŸŒˆ','ğŸŒŠ'];
        const colorPool = ['#2e7d32','#1565c0','#c62828','#6a1b9a','#ef6c00','#00838f','#37474f','#283593'];
        let board = [], currentPlayer = 1, p1Badge, p2Badge;
        let audioCtx = null;

        // [í•´ê²°] ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ì´ ì§ì ‘ ë§Œë“  í­ì£½ ì‹œìŠ¤í…œ
        function launchConfetti() {
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
            for(let i=0; i<100; i++) {
                const el = document.createElement('div');
                el.className = 'confetti';
                el.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
                el.style.left = Math.random() * 100 + 'vw';
                el.style.top = '-10px';
                document.body.appendChild(el);

                const duration = Math.random() * 3 + 2;
                el.animate([
                    { transform: `translate3d(0, 0, 0) rotate(0deg)`, opacity: 1 },
                    { transform: `translate3d(${(Math.random()-0.5)*200}px, 100vh, 0) rotate(${Math.random()*360}deg)`, opacity: 0 }
                ], { duration: duration * 1000, easing: 'cubic-bezier(0, .9, .6, 1)' });
                setTimeout(() => el.remove(), duration * 1000);
            }
        }

        function initSetup() {
            const p1C = document.getElementById('p1-emojis'), p2C = document.getElementById('p2-emojis'), tC = document.getElementById('theme-options');
            const p1R = [...emojiPool].sort(() => 0.5 - Math.random()).slice(0, 5);
            const p2R = [...emojiPool].sort(() => 0.5 - Math.random()).slice(0, 5);
            p1C.innerHTML = p1R.map((e, i) => `<span class="emoji-item ${i===0?'selected':''}" onclick="selectBadge(1,'${e}',this)">${e}</span>`).join('');
            p2C.innerHTML = p2R.map((e, i) => `<span class="emoji-item ${i===0?'selected':''}" onclick="selectBadge(2,'${e}',this)">${e}</span>`).join('');
            p1Badge = p1R[0]; p2Badge = p2R[0];
            const tR = [...colorPool].sort(() => 0.5 - Math.random()).slice(0, 5);
            tC.innerHTML = tR.map((c, i) => `<div class="theme-dot ${i===0?'selected':''}" style="background:${c}" onclick="selectTheme('${c}',this)"></div>`).join('');
            selectTheme(tR[0], tC.firstChild);
        }

        function selectBadge(p, e, el) {
            document.querySelectorAll(`#p${p}-emojis .emoji-item`).forEach(s => s.classList.remove('selected'));
            el.classList.add('selected'); p === 1 ? p1Badge = e : p2Badge = e;
        }

        function selectTheme(c, el) {
            document.querySelectorAll('.theme-dot').forEach(d => d.classList.remove('selected'));
            el.classList.add('selected');
            document.documentElement.style.setProperty('--board-color', c);
            document.documentElement.style.setProperty('--p1-neon', c);
            document.documentElement.style.setProperty('--p2-neon', c === '#1565c0' ? '#4caf50' : '#2196f3');
        }

        function playSound(type) {
            try {
                if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                if (audioCtx.state === 'suspended') audioCtx.resume();
                const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
                osc.type = type === 'pop' ? 'sine' : 'triangle';
                osc.frequency.setValueAtTime(type === 'pop' ? 500 : 800, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                osc.connect(gain); gain.connect(audioCtx.destination);
                osc.start(); osc.stop(audioCtx.currentTime + 0.1);
            } catch(e) {}
        }

        function startGame() {
            document.getElementById('setup-screen').style.display = 'none';
            document.getElementById('p1-card').innerText = p1Badge;
            document.getElementById('p2-card').innerText = p2Badge;
            board = Array(8).fill().map(() => Array(8).fill(0));
            board[3][3] = 2; board[3][4] = 1; board[4][3] = 1; board[4][4] = 2;
            renderBoard(); updateUI();
        }

        function renderBoard(flips = []) {
            const b = document.getElementById('board'); b.innerHTML = '';
            let s1 = 0, s2 = 0;
            for (let r = 0; r < 8; r++) {
                for (let c = 0; c < 8; c++) {
                    const cell = document.createElement('div'); cell.className = 'cell'; cell.onclick = () => handleMove(r, c);
                    if (board[r][c] !== 0) {
                        const cont = document.createElement('div'); cont.className = 'badge-container';
                        const f = document.createElement('div'); f.className = 'badge-face';
                        const bk = document.createElement('div'); bk.className = 'badge-face badge-back';
                        const isF = flips.some(x => x[0] === r && x[1] === c);
                        if (board[r][c] === 1) { f.innerText = isF?p2Badge:p1Badge; bk.innerText = p1Badge; s1++; }
                        else { f.innerText = isF?p1Badge:p2Badge; bk.innerText = p2Badge; s2++; }
                        cont.appendChild(f); cont.appendChild(bk); cell.appendChild(cont);
                        if (isF) setTimeout(() => { cont.classList.add('flipped'); playSound('pop'); }, flips.findIndex(x => x[0]===r && x[1]===c) * 80);
                    }
                    b.appendChild(cell);
                }
            }
            document.getElementById('p1-score-ui').innerText = `${p1Badge} ${s1}`;
            document.getElementById('p2-score-ui').innerText = `${p2Badge} ${s2}`;
        }

        function handleMove(r, c) {
            if (board[r][c] !== 0) return;
            const f = getFlips(r, c, currentPlayer);
            if (f.length === 0) return;
            playSound('pop'); board[r][c] = currentPlayer;
            f.forEach(x => board[x[0]][x[1]] = currentPlayer);
            renderBoard(f); currentPlayer = currentPlayer === 1 ? 2 : 1;
            updateUI(); checkEnd();
        }

        function getFlips(r, c, p) {
            const opp = p === 1 ? 2 : 1;
            const dirs = [[0,1],[0,-1],[1,0],[-1,0],[1,1],[1,-1],[-1,1],[-1,-1]];
            let all = [];
            dirs.forEach(([dr, dc]) => {
                let temp = [], nr = r + dr, nc = c + dc;
                while (nr >= 0 && nr < 8 && nc >= 0 && nc < 8 && board[nr][nc] === opp) { temp.push([nr, nc]); nr += dr; nc += dc; }
                if (nr >= 0 && nr < 8 && nc >= 0 && nc < 8 && board[nr][nc] === p) all = all.concat(temp);
            });
            return all;
        }

        function canMove(p) {
            for (let r = 0; r < 8; r++) for (let c = 0; c < 8; c++) if (board[r][c] === 0 && getFlips(r, c, p).length > 0) return true;
            return false;
        }

        function updateUI() {
            document.body.className = currentPlayer === 1 ? 'p1-turn' : 'p2-turn';
            document.getElementById('progress-bar').style.left = currentPlayer === 1 ? '0%' : '50%';
            document.getElementById('p1-card').className = 'focus-card' + (currentPlayer === 1 ? ' active' : '');
            document.getElementById('p2-card').className = 'focus-card' + (currentPlayer === 2 ? ' active' : '');
            document.getElementById('pass-btn').disabled = canMove(currentPlayer);
        }

        function checkEnd() {
            if (!canMove(1) && !canMove(2)) {
                const s1 = board.flat().filter(x => x === 1).length;
                const s2 = board.flat().filter(x => x === 2).length;
                document.getElementById('modal-result-text').innerText = s1 > s2 ? `P1 WIN (${s1}:${s2})` : `P2 WIN (${s2}:${s1})`;
                document.getElementById('result-modal').style.display = 'flex';
                launchConfetti(); playSound('win');
            }
        }

        function openRestartModal() { document.getElementById('restart-modal').style.display = 'flex'; }
        function confirmRestart(res) { document.getElementById('restart-modal').style.display = 'none'; if(res) startGame(); }
        function handlePass() { currentPlayer = currentPlayer === 1 ? 2 : 1; updateUI(); checkEnd(); }

        initSetup();
    </script>
</body>
</html>


